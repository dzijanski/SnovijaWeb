<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
  <link rel="stylesheet" href="css/scrollbar.css">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сновія - прапанаваць пераклад</title>
    <meta name="description">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link rel="stylesheet" href="css/cards.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/translation.css">

    <link rel="icon" type=" image/x-icon" href="icon.png">


    <link rel="stylesheet" href="css/var.css">
</head>

<body>
    <div class="header">
        <a href="index" class="logo">
            <img src="title2.png" alt="Logo" width="145" height="39">
            <style>
              .logo img {
                border-radius: 20px;
              }
              </style>
        <div class="headerbtn">
            <a href="index" class="main hbtn">Галоўная</a>
            <a href="about" class="team hbtn">Пра нас</a>
            <a href="faq" class="faq hbtn">FAQ</a>
            <a href="translation" class="addtranslation hbtn">Дадаць пераклад</a>

      <script src="https://kit.fontawesome.com/a0ff110df7.js" crossorigin="anonymous"></script>
      <a href="https://send.monobank.ua/jar/3eoWaEfxde" class="addtranslation hbtn"><i class="fa-solid fa-gift"></i> Падтрымаць</a>

        </div>
    </div>
    <div class="TotalContainer">
        <div class="TotalTranslation"><span id="TotalTranslation">Модаў перакладзена: 000</span></div>
    </div>
    <div id="AddItemContainer" class="AddItemContainer">
        <div class="form">
            <form id="TranslationForm">
                <label for="entry.1605450482">Назва перакладзенага <span class="required" alt="Абавязковае поле" title="Абавязковае поле">*</span></label>
                <input id="ItemName" type="text" name="entry.1605450482" required>
                <label for="entry.2129753653">Ваша імя/назва каманды <span class="required" alt="Абавязковае поле" title="Абавязковае поле">*</span></label>
                <input id="Name" type="text" name="entry.2129753653" required>
                <label for="entry.112020502">Перакладзены значок/лагатып <span class="required" alt="Абавязковае поле" title="Абавязковае поле">*</span></label>
                <input id="Image" type="text" name="entry.112020502" required>
                <label for="entry.500673411">Спасылка на гульню/мод (можна некалькі) <span class="required" alt="Абавязковае поле" title="Абавязковае поле">*</span></label>
                <input id="GMUrl" type="text" name="entry.500673411">
                <label for="entry.56713701">Спасылка на пераклад <span class="info" alt="Неабавязковае поле, калі ваш пераклад дадаецца да перакладзенага" title="Неабавязковае поле, калі ваш пераклад дадаецца да перакладзенага">?</span><span style="color: green; margin-left: 5px;" class="info" alt="вы можаце адправіць некалькі спасылак, падзяліўшы іх прабеламі" title="вы можаце адправіць некалькі спасылак, падзяліўшы іх прабеламі">?</span> </label>
                <input id="TrnalstionLink" type="text" name="entry.56713701">
                <label id="added" for="entry.666320625" required>Ці быў ваш пераклад афіцыйна дададзены? <span class="required"
                        alt="Абавязковае поле" title="Абавязковае поле">*</span></label>
                <div class="radio">
                    <label for="entry.666320625">Так</label>
                    <input value="True" type="radio" name="entry.666320625">
                    <label for="entry.666320625">Не</label>
                    <input value="False" type="radio" name="entry.666320625">
                </div>
                <label for="entry.785774625">Кантакты і дадатковая інфармацыя<span class="required" alt="Абавязковае поле"
                        title="Абавязковае поле">*</span> </label>
                <textarea id="Contact" type="text" name="entry.785774625" required></textarea>
                <div class="processingCont">
                    <input type="checkbox" name="Processing " id="Processing" required>
                    <div class="Processing">Я даю згоду на апрацоўку дадзеных і іх выкарыстанне на сайце Snovija
                        <span class="required" alt="Абавязковае поле" title="Абавязковае поле">*</span>
                    </div>
                </div>
                <button id="submit" type="submit" class="submit hbtn">Адправіць</button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Attach event listener to the submit button
            const submitButton = document.getElementById('submit');
            if (submitButton) {
                submitButton.addEventListener('click', sendContact);
            } else {
                console.error('Submit button not found');
            }

            async function sendContact(ev) {
    ev.preventDefault();

    const itemname = document.getElementById('ItemName').value;
    const name = document.getElementById('Name').value;
    const image = document.getElementById('Image').value;
    const gmurl = document.getElementById('GMUrl').value;
    const trnalstionLink = document.getElementById('TrnalstionLink').value;
    const added = document.querySelector('input[name="entry.666320625"]:checked') 
        ? document.querySelector('input[name="entry.666320625"]:checked').value 
        : null;
    const contact = document.getElementById('Contact').value;
    const processingCheckbox = document.getElementById('Processing');

    if (!itemname || !name || !image || !contact || !added || !processingCheckbox.checked) {
        alert('Будь ласка, заповніть всі обов\'язкові поля та підтвердіть обробку даних.');
        return;
    }

    const timestamp = new Date().toISOString();

    let thumbnail = null;
    if (isValidImageUrl(image)) {
        thumbnail = { url: image };
    }

    const webhookBody = {
        embeds: [{
            title: itemname,
            fields: [
                { name: ':paintbrush: Назва перекладеного', value: itemname },
                { name: ':bust_in_silhouette: Ваше ім\'я/назва команди', value: name },
                { name: ':frame_photo: Зображення перекладеного', value: image },
                { name: ':paperclips: Посилання на гру/мод(можна декілька)', value: gmurl },
                { name: ':link: Посилання на переклад', value: trnalstionLink },
                { name: ':eyes: Чи додали ваш перклад офіційно', value: added },
                { name: ':thread: Контакти та додаткова інформація', value: contact },
            ],
            thumbnail: thumbnail,
            timestamp: timestamp,
        }],
    };

    try {
        const response = await fetch('/.netlify/functions/discordWebhook', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(webhookBody),
        });

        if (response.ok) {
            // Надсилаємо дані до Google Forms
            const form = document.querySelector('form');
            const formData = new FormData(form);

            const googleFormsUrl = 'https://docs.google.com/forms/d/1UaAQAJ1iZWmhDKxmbCytomdZpDgu_y7mh72oenMzUY8/formResponse';

            try {
                await fetch(googleFormsUrl, {
                    method: 'POST',
                    body: formData,
                    mode: 'no-cors',
                });

                window.location.href = 'submited';
            } catch (error) {
                console.error('Помилка при надсиланні до Google Forms:', error);
                window.location.href = 'submited';
            }
        } else {
            alert('Сталась якась помилка, перевірте введені дані та спробуйте ще раз.');
        }
    } catch (error) {
        console.error('Помилка при надсиланні до серверної функції:', error);
        alert('Сталась якась помилка, перевірте введені дані та спробуйте ще раз.');
    }
}

            // Function to validate image URL
            function isValidImageUrl(url) {
                // Regular expression to match image URL format
                const regex = /(https?:\/\/.*\.(?:png|jpg|jpeg|gif|bmp|svg))/i;
                return regex.test(url);
            }
        });
    </script>


    <div class="footer">
        <div class="footertext">
            <div class="infotext">© 2025 Snovija Studios Translates</div>
            <div class="infotext">Зроблена з гонарам для беларусаў! ❤</div>
        </div>
        <script type="module" src="js/countTranslations.js"></script>

        <script src="js/logo.js"></script>
</body>

</html>